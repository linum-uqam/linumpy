manifest {
    nextflowVersion = '<= 23.10'
}

process {
    publishDir = {"$params.output"}
    scratch = true
    stageInMode='symlink'
    stageOutMode='rsync'
    errorStrategy = { task.attempt <= 3 ? 'retry' : 'ignore' }
    maxRetries = 3
    afterScript='sleep 1'
}

profiles {
    standard {
        apptainer {
            autoMounts = true
            enabled = true
        }
    }

    calliste {
        apptainer {
            cacheDir='/scratchCalliste/apptainer/cache'
            libraryDir='/scratchCalliste/apptainer/library'
            autoMounts = true
            enabled = true
            runOptions = '-B /mnt/apptainer_tmp:/tmp'
        }
        docker {
            temp = '/mnt/apptainer_tmp'
        }
        process {
            withName: "create_mosaic_grid" { 
                scratch = false
            }
        }
    }
}